"use strict";function int(a){return parseInt(a,10)}angular.module("dockerUiApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","ui.bootstrap.modal","route-segment","view-segment","chieffancypants.loadingBar","ui.bootstrap.pagination","ui.bootstrap.progressbar","ui.bootstrap.alert","decipher.tags","ui.bootstrap.typeahead","ui.bootstrap.datepicker","base64"]).config(["$routeProvider","$locationProvider","$routeSegmentProvider","cfpLoadingBarProvider",function(a,b,c,d){d.includeSpinner=!0,d.textSpinner="Wait...",b.hashPrefix("!"),c.options.autoLoadTemplates=!0,c.when("/","root").when("^/set/:key/:value*","root.set").when("/info","root.info").when("/events","root.events").when("/container/create","root.createContainer").when("/container/:containerId","root.container").when("/containers","root.containers").when("/images","root.images").when("/images/search","root.images-search").when("/image/:imageId","root.image").when("/logout","root.logout").segment("root",{templateUrl:"views/main.html",controller:"MainCtrl",title:"Docker.io: Control Panel"}).within().segment("logout",{resolve:{data:["$rootScope","$cookies","$location",function(a,b,c){a.auth=b.auth="",c.path("/info")}]}}).segment("set",{resolve:{data:["$q","$location","$route","Config","Docker",function(a,b,c,d,e){var f=a.defer(),g=c.current.params.key;return d[g]=c.current.params.value,e.version(function(a){f.resolve(a),b.path("/info")}).error(function(){f.reject(new Error("Error connecting to host"))}),f.promise}]}}).segment("info",{templateUrl:"views/info.html",controller:"InfoCtrl",title:"Docker.io: Info"}).segment("event",{templateUrl:"views/event.html",controller:"EventCtrl",title:"Docker.io: Event"}).segment("events",{templateUrl:"views/events.html",controller:"EventsCtrl",title:"Docker.io: Events"}).segment("createContainer",{templateUrl:"views/create-container.html",controller:"CreateContainerCtrl",title:"Docker.io: Create Container"}).segment("container",{templateUrl:"views/container.html",controller:"ContainerCtrl",title:"Docker.io: Container",resolve:{container:["$q","$route","Docker",function(a,b,c){var d=b.current.params.containerId,e=a.defer();return c.inspect({ID:d},function(a){e.resolve(a)}),e.promise}]},dependencies:["containerId"]}).segment("containers",{templateUrl:"views/containers.html",controller:"ContainersCtrl",title:"Docker.io: Containers"}).segment("image",{templateUrl:"views/image.html",controller:"ImageCtrl",reloadOnSearch:!1,title:"Docker.io: Image"}).segment("images",{templateUrl:"views/images.html",controller:"ImagesCtrl",title:"Docker.io: Images"}).segment("images-search",{templateUrl:"views/images-search.html",controller:"ImagesSearchCtrl",title:"Docker.io: Images Search"}),a.otherwise({redirectTo:"/info"})}]),angular.module("dockerUiApp").config(["$httpProvider",function(a){a.interceptors.push(["$rootScope",function(a){return{requestError:function(b){return b.data?(a.alert.value={type:"warning",msg:b.data},b):b},responseError:function(b){return b.data?(a.alert.value={type:"warning",msg:b.data},b):b}}}])}]).controller("MainCtrl",["$scope","$log","$rootScope","$http","$location","$cookies","$base64","cfpLoadingBar","Docker",function(a,b,c,d,e,f,g,h,i){if(c.search=a.search={value:""},c.alert=a.alert={value:null},a.currentLocation=e.$$path.split("/").slice(0,2).join("/"),c.$on("$routeChangeSuccess",function(b,c){a.currentLocation=c.$$route&&c.$$route.originalPath||e.$$path.split("/").slice(0,2).join("/"),h.status()&&h.complete()}),f.auth)try{a.auth=c.auth=JSON.parse(f.auth),a.auth.password=JSON.parse(g.decode(a.auth.data)).password,i.auth(a.auth,function(d){"Login Succeeded"!==d.Status&&(a.auth=c.auth=f.auth="",b.error("Auth error",d)),delete a.auth.password})}catch(j){b.error("Failed to parse cookies"),a.auth=c.auth=f.auth=""}a.authenticate=function(){i.authenticate(null,function(b,d){b||(d.data=g.encode(JSON.stringify(d)),delete d.password,a.auth=c.auth=d,f.auth=JSON.stringify(d))})}}]),angular.module("dockerUiApp").controller("ContainersCtrl",["$scope","$location","Docker",function(a,b,c){a.containers=[],a.containerOpts={colDef:[{name:"Id",field:"Id",map:function(a){return a.slice(0,12)},link:"/container/{{Id | shortTag}}"},{name:"Name",field:"Names",map:function(a){return a.map(function(a){return a.slice(1)}).join(",")},link:"/container/{{ Id | shortTag }}"},{name:"Image",field:"Image"},{name:"Size",field:"SizeRw",filter:{name:"calcMem"}},{name:"Status",field:"Status"},{name:"Created",field:"Created",map:function(a){return new Date(1e3*a)},filter:{name:"date",options:"mediumDate"}}],rowClass:function(a){return{success:!/^Exit/g.test(a.Status)}},sortBy:"Status",globalFilter:!0},a.options={size:!0,all:!0},a.reload=function(){c.containers(a.options,function(b){a.containers=b})},a.createContainer=function(){c.createContainer({},function(a){a&&b.path("/container/"+a.Id.slice(0,12))})},a.reload()}]),angular.module("dockerUiApp").controller("ImagesCtrl",["$scope","$location","Docker",function(a,b,c){function d(a,b){var c={},d=b||[],e={};return a.forEach(function(a){c[a.Id]=a,e[a.Id]=e[a.Id]||[],a.children=e[a.Id],a.ParentId?e[a.ParentId]?e[a.ParentId].push(a):e[a.ParentId]=[a]:d.push(a)}),d}a.images=[],a.options={all:!0,tree:!0},a.reload=function(){c.images(a.options,function(b){a.images.splice(0),a.images=a.options.tree?d(b):b})},a.imagesOpts={colDef:[{name:"Id",field:"Id",map:function(a){return a.slice(0,12)},link:"/image/{{ Id | shortTag }}"},{name:"Name",field:"RepoTags",link:"/image/{{ Id | shortTag }}",map:function(a){return a[0].split(":")[0]}},{name:"Tags",field:"RepoTags",map:function(a){return a.map(function(a){return a.split(":")[1]}).filter(function(a){return!!a}).join(", ")}},{name:"Size",field:"Size",filter:"calcMem"},{name:"Virtual Size",field:"VirtualSize",filter:"calcMem"},{name:"Created",field:"Created",map:function(a){return new Date(1e3*a)},filter:{name:"date"}}],nested:!0,globalFilter:!0},a.destroyImage=function(){a.imageId&&c.deleteImage({ID:a.imageId},function(){})},a.searchImages=function(){b.path("/images/search")},a.reload()}]),angular.module("dockerUiApp").controller("EventsCtrl",["$scope","Docker",function(a,b){a.events=[],a.since=new Date,a.stream=null,a.getEvents=function(){a.stream&&(a.stream.abort(),a.events=[]);var c=new Date(a.since.getTime());c.setUTCHours(0),c.setUTCMinutes(0),c.setUTCSeconds(0),a.stream=b.events("since="+(c.getTime()/1e3>>>0),function(b){b.forEach(function(b){a.events.unshift(b)}),a.$apply()},angular.noop)},a.$on("$destroy",function(){a.stream&&(a.stream.abort(),a.stream=null),a.events=[]}),a.eventsOpts={colDef:[{name:"Id",field:"id",filter:"shortTag"},{name:"Event",field:"status"},{name:"From",field:"from"},{name:"Time",field:"time",map:function(a){return new Date(1e3*a)},filter:{name:"date",options:"medium"}}],globalFilter:!0},a.sinceOpts={max:(new Date).getTime(),"show-button-bar":!1,showWeeks:!1,startingDay:1},a.getEvents()}]),angular.module("dockerUiApp").service("http",["$http",function(a){function b(a,b){return a.replace(/(\/:[^\/]+)/g,function(a,c){var d=c.substr(2);if(b.hasOwnProperty(d)){var e=b[d];return delete b[d],"/"+e}return""})}function c(a,b){var c,d={},e=Object.getOwnPropertyNames(a),f=e.length;for(c=0;f>c;c+=1){var g=e[c],h=a[g],i=h;"@"===h[0]?i=b[h.substr(1)]:"="===h[0]&&(h=g,i=b[h]),void 0!==i&&(d[g]=i)}return d}function d(d){return function(e,f,h){function i(a){return function(){var b=[].slice.call(arguments);if(angular.isFunction(g.errorHandler)){if("error"===a)return void g.errorHandler.apply(null,b)}else"error"!==a&&b.unshift(null);h.apply(this,b)}}h||(h=f,f=e),h||(h=f,f=e={}),e=c(angular.extend({},d.params),e);var j=b(g.url(),e),k={method:d.method,url:j,params:e};return d.target&&"self"===d.target?void(location.href=k.url):("POST"===d.method&&(k.data=f),d.withCredentials&&(k.withCredentials=!0),d.responseType&&(k.responseType=d.responseType),d.timeout&&(k.timeout=d.timeout),d.headers&&(k.headers=d.headers),d.transformRequest&&(k.transformRequest=d.transformRequest),a(k).success(function(a){var b=a.error?"error":"success";i(b)(a)}).error(i("error")))}}function e(a,b){b=b||{};var c;for(c in a)a.hasOwnProperty(c)&&(b[c]=d(a[c]));return b}function f(a,b,c,d){angular.extend(g,{url:a});for(var f=new FormData,h={path:b,files:{}},i=0;i<c.length;i+=1){var j=c[i];h.files[j.name]=j.size}f.append("metadata",JSON.stringify(h));for(var i=0;i<c.length;i+=1)f.append("uploadInput",c[i]);var k=e({uploadFile:{method:"POST",data:f,transformRequest:angular.identity,headers:{"Content-Type":void 0},params:{}}});k.uploadFile({},f,d)}var g={url:"",errorHandler:null};return{createMethod:d,config:function(a){angular.extend(g,a)},createService:e,uploadFiles:f}}]),angular.module("dockerUiApp").service("Docker",["$rootScope","$q","$filter","http","$sce","stream","$modal","Config",function a(b,c,d,e,f,g,h,i){function a(){return this instanceof a?this.servers[i.host]?this.servers[i.host]:(this.servers[i.host]=this,this):new a}function j(a,b){var c=this,d=h.open({templateUrl:"views/auth.html",resolve:{auth:function(){return a||{}}},controller:["$scope",function(e){e.auth=a||{},e.login=function(){c.auth(e.auth,function(a){"Login Succeeded"===a.Status?b(null,e.auth):b(new Error(a))}),d.close()},e.close=function(){d.close(),b(!1)}}]})}return a.prototype.servers={},a.prototype.client=function(){return this.servers[i.host]},e.config({url:function(){return i.host+"/v1.10/:service/:p1/:p2"},errorHandler:function(a){b.alert.value={type:"error",msg:a}}}),e.createService({containers:{method:"GET",params:{service:"containers",p1:"json",size:"=",all:"="}},inspect:{method:"GET",params:{service:"containers",p1:"@ID",p2:"json"}},processList:{method:"GET",params:{service:"containers",p1:"@ID",p2:"top",ps_args:"="}},create:{method:"POST",params:{service:"containers",p1:"create",name:"="}},changes:{method:"GET",params:{service:"containers",p1:"@ID",p2:"changes"}},start:{method:"POST",params:{service:"containers",p1:"@ID",p2:"start"}},stop:{method:"POST",params:{service:"containers",p1:"@ID",p2:"stop"}},restart:{method:"POST",params:{service:"containers",p1:"@ID",p2:"restart"}},kill:{method:"POST",params:{service:"containers",p1:"@ID",p2:"kill"}},_destroy:{method:"DELETE",params:{service:"containers",p1:"@ID"}},_commit:{method:"POST",params:{service:"commit",container:"=",repo:"=",tag:"=",m:"=",author:"=",run:"="}},"export":{method:"GET",target:"self",params:{service:"containers",p1:"@ID",p2:"export"}},images:{method:"GET",params:{service:"images",p1:"json",all:"="}},insertToImage:{method:"POST",params:{service:"images",p1:"@ID",insert:"insert",path:"=",url:"="}},inspectImage:{method:"GET",params:{service:"images",p1:"@ID",p2:"json"}},historyImage:{method:"GET",params:{service:"images",p1:"@ID",p2:"history"}},deleteImage:{method:"DELETE",params:{service:"images",p1:"@ID"}},searchImage:{method:"GET",params:{service:"images",p1:"search",term:"="}},info:{method:"GET",params:{service:"info"}},version:{method:"GET",params:{service:"version"}},auth:{method:"POST",params:{service:"auth"},error:!0}},a.prototype),a.prototype.createContainer=function(a,b){var e=this,f={Image:"base",PortSpecs:[],ExposedPorts:[],Env:[],Dns:["8.8.8.8","8.8.4.4"],Tty:!0,AttachStdin:!0,AttachStdout:!0,AttachStderr:!0,OpenStdin:!0,StdinOnce:!0,Volumes:[],VolumesFrom:[]},g=angular.extend({},f,a);h.open({templateUrl:"views/create-container.html",resolve:{input:function(){return g}},controller:["$scope","$modalInstance","$timeout","input",function(a,f,g,h){function i(a,b){return d("filter")(a,b)}a.input=h,a.images=[],a.containers=[],a.getImage=function(b){if(a.images.length){var d=c.defer();return d.resolve(i(a.images,b)),d.promise}return e.images(function(c){return a.images=c.map(function(a){return a.RepoTags[0]}),i(a.images,b)})},a.getContainer=function(b){if(a.containers.length){var d=c.defer();return d.resolve(i(a.containers,b)),d.promise}return e.containers({all:!0},function(c){return a.containers=c.map(function(a){return a.Names[0].substr(1)}),i(a.containers,b)})},a.ok=function(){if(a.input.VolumesFrom.length||delete a.input.VolumesFrom,a.input.Volumes.length){var c={},d=[];a.input.Volumes.forEach(function(a){var b=a.split(":");c[b[1]]={},d.push(a)}),a.input.Volumes=c}else delete a.input.Volumes;e.create(a.input,function(a){f.close(),e.start({ID:a.Id,Binds:d,Cmd:["/bin/sh"]},function(){b(a)})})},a.close=function(){f.close(),b(!1)}}]})},a.prototype.destroy=function(a,b){var c=this,d=h.open({templateUrl:"views/destroy-container.html",resolve:{instance:function(){return a}},controller:["$scope",function(e){e.instance=a,e.ok=function(){c._destroy({ID:a.ID.slice(0,12),v:e.removeAll},function(){d.close(),b(!0)})},e.close=function(){d.close(),b(!1)}}]})},a.prototype.commit=function(a,b){var c=this,d=h.open({templateUrl:"views/commit-container.html",resolve:{instance:function(){return a}},controller:["$scope",function(e){e.instance=a,e.input={repo:a.Name.substr(1),container:a.ID.slice(0,12)},e.ok=function(){c._commit(e.input,function(a){b(a),d.close()})},e.close=function(){d.close(),b(!1)}}]})},a.prototype.createImage=function(a,b){var c={url:i.host+"/images/create?"+(a.query||""),method:a.method||"POST",parseStream:!0,progressHandler:a.progressHandler},d=g.request(c);return d.then(b),d},a.prototype.events=function(a,b,c){var d={url:i.host+"/events?"+a||"since=1",method:"GET",parseStream:!0,progressHandler:b},e=g.request(d);return e.then(c),e},a.prototype.logs=function(a,b,c){var d=[];["stderr","stdout","tail"].forEach(function(b){a[b]&&d.push(b+"="+a[b])}),d.push("timestamps=0&follow=1");var e={url:i.host+"/containers/"+a.ID+"/logs?"+d.join("&"),method:"GET",parseStream:!1,progressHandler:b},f=g.request(e);return f.then(c),f},a.prototype.authenticate=function(a,b){var c=this;a?c.auth(a,function(){console.warn(arguments),j.call(c,a,b)}):j.call(c,a,b)},new a}]),angular.module("dockerUiApp").value("Config",{host:"http://localhost:4243"}),angular.module("dockerUiApp").directive("ngAppendHtml",["$compile",function(a){return function(b,c,d){c.append(a(angular.element(b.$eval(d.ngAppendHtml)))(b))}}]),angular.module("dockerUiApp").directive("dcGrid",["$compile","$parse","$rootScope","$filter",function(a,b,c,d){return{template:'<div>                <div class="row">                    <div class="col-sm-2">                        <pager total-items="totalItems" items-per-page="maxSize" page="currentPage" num-pages="numPages"></pager>                    </div>                    <div class="pager col-sm-1 center-block" style="padding-top: 6px;">                        Page: {{ currentPage }} / {{ numPages }}                    </div>                </div>                <table class="table table-hover">                    <thead>                        <tr>                            <th data-ng-repeat="def in options.colDef" data-ng-click="sort(def.field)" style="cursor: pointer;">                                <i data-ng-class=\'{"glyphicon-chevron-up": sortUp(def.field), "glyphicon-chevron-down": sortDown(def.field)}\' class="glyphicon"></i>{{ def.name }}                            </th>                        </tr>                    </thead>                    <tbody>                        <tr data-ng-repeat-start="row in rows"                             data-ng-class="rowClass(row)"                             data-ng-click="subgrid(row)"                             style="min-width: 50px;">                            <td data-ng-repeat="def in options.colDef"                                 data-ng-append-html="get(row, def)"                                 data-ng-compile="def.compile"                                 style="{{def.style}}"                                 data-ng-class="def.class"></td>                        </tr>                        <tr data-ng-repeat-end data-ng-show="nested && row.Id === active" data-name="parent-{{ row.Id }}">                            <td colspan="{{ options.colDef.length }}">                                <span style="padding-left: 40px"></span>                            </td>                        </tr>                    </tbody>                </table>            </div>',restrict:"E",replace:!0,scope:{options:"=",items:"="},link:function(e){function f(a){a.length&&(e.totalItems=a.length,e.sortBy&&e.sortType&&(a=d("orderBy")(a,e.sortBy,e.sortType)),e.rows=a.slice((e.currentPage-1)*e.maxSize,e.currentPage*e.maxSize),h=!1)}e.currentPage=1,e.maxSize=e.options.maxSize||10,e.nested=!!e.options.nested,e.active=null;var g=[],h=!1;e.$watchCollection("items",function(a){h=!0,e.currentPage=1,g=a||[],f(g)}),e.$watch("currentPage",function(){h||f(g)}),e.sortBy=e.options.sortBy,e.sortType=!!e.options.sortBy,e.sort=function(a){e.sortBy!==a?(e.sortBy=a,e.sortType=!0):e.sortType?e.sortType=!1:(e.sortType=null,e.sortBy=null),f(g)},e.sortUp=function(a){return e.sortBy===a&&e.sortType===!0},e.sortDown=function(a){return e.sortBy===a&&e.sortType===!1},e.options.globalFilter&&c.$watch("search.value",function(a){h||(g=d("filter")(e.items,a),f(g))}),e.rowClass=function(a){return e.options.rowClass?e.options.rowClass(a):""},e.subgrid=function(b){if(e.nested){if(!b.children||!b.children.length||e.active===b.Id)return void(e.active=null);e.active=b.Id;var c=e.$new();c.options=e.options,c.items=b.children,angular.element("[data-name=parent-"+b.Id+"] span").html("").append(a('<dc-grid data-options="options" data-items="items"></dc-grid>')(c))}},e.get=function(c,f){var g=b(f.field),h=g(e,c),i=null;return c.$watch=function(a,b){b(a(c),null)},Array.isArray(f.buttons)?(i="",f.buttons.forEach(function(a,b){i+='<button class="btn '+a.class+'" data-ng-click="def.buttons['+b+'].click(row)">'+a.name+"</button>"}),i):("function"==typeof f.map?h=f.map(h,c):"string"==typeof f.map&&(i=angular.element("<div>"+f.map+"</div>"),h=a(i)(c).html()),f.filter&&(h="string"==typeof f.filter?d(f.filter)(h):d(f.filter.name)(h,f.filter.options)),f.link?(i=angular.element('<div><a href="#!'+f.link+'">'+h+"</a></div>"),i=a(i)(c).html()):i=h,void 0===i&&(i=""),"<span>"+i+"</span>")}}}}]),angular.module("dockerUiApp").controller("ContainerCtrl",["$scope","$route","$timeout","$location","Config","Docker","container",function(a,b,c,d,e,f,g){function h(){a.active&&(1!==a.Console.socket.readyState?(delete a.Console.socket,a.attachConsole()):c(h,1e3))}a.active=!0,a.container=g,a.containerId=b.current.params.containerId,a.changes=[],a.Console={logs:{terminal:null,connection:null}},a.changesOpts={colDef:[{name:"Filename",field:"Path"}],rowClass:function(a){return{warning:!!a.Kind}},maxSize:5},a.getContainer=function(){f.inspect({ID:a.containerId},function(b){a.container=b})},a.activeTab={},a.processList=function(b){a.containerId&&a.container.State.Running&&f.processList({ID:a.containerId,ps_args:"axwuu"},function(b){a.container.ps=b}),a.activeTab[b]&&a.active&&c(a.processList.bind(a,b),2e3)},a.logs=function(){var b=angular.element("#logTerminal")[0];if((b&&a.containerId||a.Console.logs.terminal)&&!a.Console.logs.terminal){var c=a.Console.logs.terminal=new Terminal({cols:0,rows:0,useStyle:!0,screenKeys:!0});c.open(b);var d=a.Console.logs.connection=f.logs({ID:a.containerId,stdout:1,stderr:1},function(e){console.warn(arguments),b?c.write(e):(d.abort(),c.destroy(),a.Console.logs.terminal=!1)})}},a.start=function(){a.containerId&&f.start({ID:a.containerId},function(){a.getContainer()})},a.stop=function(){a.containerId&&f.stop({ID:a.containerId},function(){a.getContainer()})},a.restart=function(){a.containerId&&f.restart({ID:a.containerId},function(){a.getContainer()})},a.kill=function(){a.containerId&&f.kill({ID:a.containerId},function(){a.getContainer()})},a.destroy=function(){a.containerId&&f.destroy({ID:a.containerId},function(a){a&&d.path("/containers")})},a.commit=function(){a.containerId&&f.commit(a.container,function(a){a&&d.path("/image/"+a.Id.slice(0,12))})},a.attachConsole=function(){if(a.containerId&&!a.Console.socket){var b=document.createElement("a");b.href=e.host,a.Console.socket=new WebSocket(("https:"===b.protocol?"wss":"ws")+"://"+b.host+"/containers/"+a.containerId+"/attach/ws?logs=0&stream=1&stdout=1&stderr=1&stdin=1"),a.Console.terminal=new Terminal({cols:0,rows:0,useStyle:!0,screenKeys:!0}),a.Console.socket.onopen=function(){h()},a.Console.socket.onmessage=function(b){a.Console.terminal.write(b.data)},a.Console.socket.onclose=function(){a.Console.terminal.destroy()},a.Console.terminal.on("data",function(b){a.Console.socket.send(b)}),angular.element("#terminal").html(""),a.Console.terminal.open(angular.element("#terminal")[0])}},a.getChanges=function(){f.changes({ID:a.containerId},function(b){a.changes=b})},a.createAs=function(){f.createContainer(a.container.Config,function(a){a&&d.path("/container/"+a.Id.slice(0,12))})},a.export=function(){f.export({ID:a.containerId},function(){console.warn(arguments)})},a.$on("$destroy",function(){a.active=!1,a.activeTab={},a.Console.logs.connection&&a.Console.logs.connection.abort(),a.Console.logs.terminal&&(a.Console.logs.terminal.destroy(),a.Console.logs.terminal=!1),a.Console.socket&&a.Console.socket.close(),a.Console.terminal&&a.Console.terminal.destroy()})}]),angular.module("dockerUiApp").filter("calcMem",function(){return function(a,b,c){var d=parseInt(a,10);d||(d=0),b||c||(b="bytes",c=3),c||(c=b,b="bytes");var e=["bytes","Mb","Gb","Tb","Pb"],f=e.indexOf(b);for(f=f>=0?f:0;f<e.length;f+=1)if(f){if(!(d>1024))break;d/=1024,b=e[f-1]}return d.toFixed(2)+(d?b:"")}}),angular.module("dockerUiApp").controller("ImageCtrl",["$scope","$rootScope","$route","$location","Docker",function(a,b,c,d,e){a.imageId=c.current.params.imageId,a.destroyImage=function(){a.imageId&&e.deleteImage({ID:a.imageId.slice(0,12)},function(a){console.warn(a),d.path("/images")})},a.history=[],a.getImage=function(b){e.inspectImage({ID:b},function(b){a.image=b}),e.historyImage({ID:b},function(b){a.history=b})},a.getImage(a.imageId),b.$on("$routeChangeSuccess",function(b,c){c.params.imageId&&a.getImage(c.params.imageId.slice(0,12))}),a.imageHistoryOpts={colDef:[{name:"Id",field:"Id",filter:"shortTag",link:"/image/{{ Id | shortTag }}"},{name:"Created By",field:"CreatedBy",map:function(a){return a||""}},{name:"Date",field:"Created",map:function(a){return new Date(1e3*a)},filter:"date"},{name:"Size",field:"Size",filter:"calcMem"}],maxSize:5}}]),angular.module("dockerUiApp").controller("ImagesSearchCtrl",["$scope","$modal","Docker",function(a,b,c){function d(a,b,c){return'<i class="glyphicon glyphicon-star'+(a?"":"-empty")+'"'+(void 0!==c?' title="'+c+'"':"")+"></i>"}function e(b){var c=Math.round(a.maxRate?b/a.maxRate*5:0);return[1,2,3,4,5].map(function(a,e){return d(c&&c>=e,void 0,b)}).join("")}function f(a){var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}a.images=[],a.imageSearch="",a.maxRate=0,a.doSearch=function(){c.searchImage({term:a.imageSearch},function(b){b.forEach(function(b){a.maxRate=a.maxRate>=b.star_count?a.maxRate:b.star_count}),a.images=b})},a.downloadImage=function(d){a.progress={},b.open({templateUrl:"views/download-image.html",resolve:{image:function(){return d},progress:function(){return a.progress}},controller:["$scope","$modalInstance","image","progress",function(a,b,c,d){a.image=c,a.progress=d,a.background=a.close=function(){b.close()}}]}),c.createImage({query:"fromImage="+d.name,progressHandler:function(b){Array.isArray(b)&&(b.forEach(function(b){if(!b.id)return void(d.statusMessage=b.status);var c=a.progress[b.id]=a.progress[b.id]||{active:!0,total:0,k:0};f(b.progressDetail)||(c.start=c.start||new Date(1e3*b.progressDetail.start),c.total=b.progressDetail.total,c.current=b.progressDetail.current,c.k=100*c.current/c.total),"Download complete"===b.status&&(c.k=100,c.current=c.total,c.active=!1),c.status=b.status}),a.$apply())}},function(){console.warn("Download complete",arguments)})},a.imagesOpts={colDef:[{name:"Name",field:"name"},{name:"Trusted",field:"is_trusted",map:d},{name:"Official",field:"is_official",map:d},{name:"Rating",field:"star_count",map:e},{name:"Description",field:"description",style:"max-width: 500px;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",map:function(){return'<span popover="{{ row.description }}" popover-trigger="mouseenter">{{ row.description }}</span>'}},{name:"Actions",buttons:[{name:'<i class="glyphicon glyphicon-download"></i> Download',"class":"btn btn-xs btn-primary",click:function(b){a.downloadImage(b)}}],compile:!0}],globalFilter:!0}}]);var lowercase=function(a){return angular.isString(a)?a.toLowerCase():a},msie=int((/msie (\d+)/.exec(lowercase(navigator.userAgent))||[])[1]);isNaN(msie)&&(msie=int((/trident\/.*; rv:(\d+)/.exec(lowercase(navigator.userAgent))||[])[1]));var XHR=window.XMLHttpRequest||function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(b){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(c){}throw new Error("This browser does not support XMLHttpRequest.")};angular.module("dockerUiApp").factory("stream",["$q","$timeout",function(a,b){function c(c){function e(){function a(a){try{return angular.fromJson(a)}catch(b){return void 0}}function b(a,b,c){var d=a.substring(c||0).search(b);return d>=0?d+(c||0):d}for(var c,d,e,f=[];~(c=b(i.response,/}\s*{/,k))&&(d=i.response.slice(k,c+1),e=a(d),void 0!==e);)f.push(e),k=c+1;return d=i.response.slice(k),e=a(d),void 0!==e&&(f.push(e),k=i.response.length),f}function f(){g=d,i&&i.abort()}var g,h=a.defer(),i=this.xhr=new XHR,j=c.headers,k=0;return i.open(c.method,c.url,!0),angular.forEach(j,function(a,b){angular.isDefined(a)&&i.setRequestHeader(b,a)}),i.onreadystatechange=function(){if(4===i.readyState){var a=null,b=null;g!==d&&(a=i.getAllResponseHeaders(),b=i.responseType?i.response:i.responseText),h.resolve(g||i.status,b,a)}},angular.isFunction(c.progressHandler)&&(i.onprogress=function(){(2===i.readyState||3===i.readyState||4===i.readyState)&&(3!==i.readyState||200===i.status)&&(c.parseStream?c.progressHandler(e()):(c.progressHandler(i.response.slice(k)),k=i.response.length))}),i.onerror=function(a){console.error(a)},c.withCredentials&&(i.withCredentials=!0),c.responseType&&(i.responseType=c.responseType),i.send(c.post||null),c.timeout>0&&b(f,c.timeout),h.promise.abort=function(){i&&i.abort()},h.promise}var d=-1;return{request:function(a){return new c(a)}}}]),angular.module("dockerUiApp").controller("InfoCtrl",["$scope","Config","Docker",function(a,b,c){a.info=null,a.version=null,a.Config=b,c.info(function(b){a.info=b}),c.version(function(b){a.version=b})}]),angular.module("dockerUiApp").filter("shortTag",function(){return function(a){return a&&a.slice(0,12)}});