"use strict";function int(a){return parseInt(a,10)}angular.module("dockerUiApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","ui.bootstrap.modal","route-segment","view-segment","angular-loading-bar","ui.bootstrap.pagination","ui.bootstrap.progressbar","base64","ui.bootstrap.alert","ui.bootstrap.typeahead","ui.bootstrap.datepicker","ui.select","ngJsonExplorer","ui.bootstrap.carousel"]).config(["$routeProvider","$locationProvider","$routeSegmentProvider","cfpLoadingBarProvider",function(a,b,c,d){d.includeSpinner=!0,d.textSpinner="Wait...",b.hashPrefix("!"),c.options.autoLoadTemplates=!0,c.when("/","root").when("^/set/host/:value*","root.set").when("/info","root.info").when("/events","root.events").when("/container/:containerId","root.container").when("/containers","root.containers").when("/images","root.images").when("/images/search","root.images-search").when("/image/:imageId","root.image").when("/hosts","root.hosts").when("/logout","root.logout").segment("root",{templateUrl:"views/main.html",controller:"MainCtrl",title:"Docker.io: Control Panel",resolve:{data:["$q","$cookies","$location","Config","Docker",function(a,b,c,d,e){var f=a.defer();return b.dockerHost=b.dockerHost||d.host,e.connectTo(b.dockerHost,function(a){f.resolve(),a&&c.path("/hosts")}),f.promise}]}}).within().segment("logout",{resolve:{data:["$rootScope","$cookies","$location",function(a,b,c){a.auth=b.auth="",c.path("/info")}]}}).segment("set",{resolve:{data:["$q","$route","$location","Docker",function(a,b,c,d){var e=a.defer(),f=b.current.params.value;return d.connectTo(f,function(a){return a?(c.path("/hosts"),e.reject(a)):void d.version(function(a){e.resolve(a)})}),e.promise}]}}).segment("info",{templateUrl:"views/info.html",controller:"InfoCtrl",title:"Docker.io: Info","default":!0,resolve:{info:["$q","Docker",function(a,b){var c=a.defer();return a.all([b.info(),b.version()]).then(function(a){var b=a[0].data;b.version=a[1].data,c.resolve(b)},c.reject.bind(c)),c.promise}]}}).segment("event",{templateUrl:"views/event.html",controller:"EventCtrl",title:"Docker.io: Event"}).segment("events",{templateUrl:"views/events.html",controller:"EventsCtrl",title:"Docker.io: Events"}).segment("createContainer",{templateUrl:"views/create-container.html",controller:"CreateContainerCtrl",title:"Docker.io: Create Container"}).segment("container",{templateUrl:"views/container.html",controller:"ContainerCtrl",title:"Docker.io: Container",dependencies:["containerId"],resolve:{container:["$q","$route","Docker",function(a,b,c){var d=b.current.params.containerId,e=a.defer();if(d)return c.inspect({Id:d,errorHandler:!1},function(a,b){a?e.reject(a):e.resolve(b)}),e.promise}]},resolveFailed:{templateUrl:"404.html"}}).segment("containers",{templateUrl:"views/containers.html",controller:"ContainersCtrl",title:"Docker.io: Containers"}).segment("image",{templateUrl:"views/image.html",controller:"ImageCtrl",reloadOnSearch:!1,title:"Docker.io: Image",dependencies:["imageId"],resolve:{image:["$q","$route","Docker",function(a,b,c){var d=b.current.params.imageId,e=a.defer();if(d)return a.all([c.inspectImage({Id:d,errorHandler:!1}),c.images({all:!0,tree:!1}),c.historyImage({Id:d})]).then(function(a){var b=a[0].data;return 200!==a[0].status?e.reject(b):(b.info=a[1].data.filter(function(a){return a.Id.substr(0,12)===d})[0]||{},b.info.RepoTags=(b.info.RepoTags||[]).filter(function(a){return"<none>:<none>"!==a}),b.history=a[2].data||[],void e.resolve(b))},e.reject.bind(e)),e.promise}]},depends:["imageId"],resolveFailed:{templateUrl:"404.html"}}).segment("images",{templateUrl:"views/images.html",controller:"ImagesCtrl",title:"Docker.io: Images"}).segment("images-search",{templateUrl:"views/images-search.html",controller:"ImagesSearchCtrl",title:"Docker.io: Images Search"}).segment("hosts",{templateUrl:"views/hosts.html",controller:"HostsCtrl",title:"Docker.io: Hosts",resolve:{hosts:["Docker",function(a){return a.hosts()}]}}),a.otherwise({redirectTo:"/info"})}]),angular.module("dockerUiApp").config(["$httpProvider",function(a){a.interceptors.push(["$rootScope","Config",function(a,b){return{request:function(c){return c.headers=c.headers||{},c.headers["X-Registry-Auth"]&&(a.auth&&b.features.registryAuth?c.headers["X-Registry-Auth"]=a.auth.data:delete c.headers["X-Registry-Auth"]),c},requestError:function(b){return b.data?(a.alert.value={type:"warning",msg:b.data},b):b},responseError:function(b){return b.data?(a.alert.value={type:"warning",msg:b.data},b):b}}}])}]).controller("MainCtrl",["$scope","$log","$rootScope","$location","$cookies","$base64","cfpLoadingBar","Docker","Config",function(a,b,c,d,e,f,g,h,i){if(c.search=a.search={value:""},c.alert=a.alert={value:null},a.currentLocation=d.$$path.split("/").slice(0,2).join("/"),a.dockerHost=c.dockerHost||i.host,a.input={Image:""},a.images=[{RepoTags:["hello"]},{RepoTags:["world"]},{RepoTags:["pipec"]}],c.$watch("dockerHost",function(b){b!==a.dockerHost&&(a.dockerHost=c.dockerHost||i.host)}),c.$on("$routeChangeSuccess",function(b,c){a.currentLocation=c.$$route&&c.$$route.originalPath||d.$$path.split("/").slice(0,2).join("/"),g.status()&&g.complete()}),e.auth)try{a.auth=c.auth=JSON.parse(e.auth),a.auth.password=JSON.parse(f.decode(a.auth.data)).password,h.auth(a.auth,function(d){"Login Succeeded"!==d.Status&&(a.auth=c.auth=e.auth="",b.error("Auth error",d)),delete a.auth.password})}catch(j){b.error("Failed to parse cookies"),a.auth=c.auth=e.auth=""}a.authenticate=function(){h.authenticate(null,function(b,d){!b&&d&&(d.data=f.encode(JSON.stringify(d)),delete d.password,a.auth=c.auth=d,e.auth=JSON.stringify(d))})}}]),angular.module("dockerUiApp").controller("ContainersCtrl",["$scope","$location","Docker",function(a,b,c){a.containers=[],a.containerOpts={colDef:[{name:"Id",field:"Id",map:function(a){return a.slice(0,12)},link:"/container/{{Id | shortTag}}"},{name:"Name",field:"Names",map:function(a){return a.map(function(a){return a.slice(1)}).join(",")},link:"/container/{{ Id | shortTag }}"},{name:"Image",field:"Image"},{name:"Size",field:"SizeRw",filter:{name:"calcMem"}},{name:"Status",field:"Status"},{name:"Created",field:"Created",map:function(a){return new Date(1e3*a)},filter:{name:"date",options:"mediumDate"}}],rowClass:function(a){return{success:a.Status&&!/^Exit/g.test(a.Status)}},sortBy:"Status",globalFilter:!0},a.options={size:!0,all:!0},a.reload=function(){c.containers(a.options,function(b){a.containers=b})},a.createContainer=function(){c.createContainer({}).then(function(a){a&&b.path("/container/"+a.Id.slice(0,12))})},a.reload()}]),angular.module("dockerUiApp").controller("ImagesCtrl",["$scope","$location","$filter","Docker",function(a,b,c,d){a.images=[],a.showUntagged=!1,a.options={all:!1,tree:!1},a.reload=function(){d.images(a.options,function(b){a.images=c("filter")(b,function(b){var c=b.RepoTags||[];return a.showUntagged||"<none>:<none>"!==c[0]})})},a.imagesOpts={colDef:[{name:"Id",field:"Id",map:function(a){return a.slice(0,12)},link:"/image/{{ Id | shortTag }}"},{name:"Name",field:"RepoTags",link:"/image/{{ Id | shortTag }}",map:function(a){var b={};return a.map(function(a){var b=d.parseTag(a);return b.nameWithRegistry}).filter(function(a){var c=!b[a];return b[a]=!0,c&&!!a}).join(", ")}},{name:"Tags",field:"RepoTags",map:function(a){var b={};return a.map(function(a){return d.parseTag(a).tag}).filter(function(a){var c=!b[a];return b[a]=!0,c&&!!a}).join(", ")}},{name:"Size",field:"Size",filter:"calcMem"},{name:"Virtual Size",field:"VirtualSize",filter:"calcMem"},{name:"Created",field:"Created",map:function(a){return new Date(1e3*a)},filter:{name:"date"}}],nested:!0,globalFilter:!0},a.searchImages=function(){b.path("/images/search")},a.buildImage=function(){b.path("/images/build")},a.reload()}]),angular.module("dockerUiApp").controller("EventsCtrl",["$scope","Docker",function(a,b){a.events=[],a.since=new Date,a.stream=null,a.getEvents=function(){a.stream&&(a.stream.abort(),a.events=[]);var c=new Date(a.since.getTime());c.setUTCHours(0),c.setUTCMinutes(0),c.setUTCSeconds(0),a.stream=b.events("since="+(c.getTime()/1e3|0),function(b){b.forEach(function(b){a.events.unshift(b)}),a.$apply()},angular.noop)},a.$on("$destroy",function(){a.stream&&(a.stream.abort(),a.stream=null),a.events=[]}),a.eventsOpts={colDef:[{name:"Id",field:"id",filter:"shortTag"},{name:"Event",field:"status"},{name:"From",field:"from"},{name:"Time",field:"time",map:function(a){return new Date(1e3*a)},filter:{name:"date",options:"medium"}}],globalFilter:!0},a.sinceOpts={max:(new Date).getTime(),"show-button-bar":!1,showWeeks:!1,startingDay:1},a.getEvents()}]),angular.module("dockerUiApp").controller("HostsCtrl",["$rootScope","$scope","$location","Docker","hosts",function(a,b,c,d,e){function f(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.unshift({url:b,created:a[b].created,lastConnected:a[b].lastConnected});return c}b.hosts=f(e),b.connectTo="",b.connect=function(e){e=e||b.connectTo,e&&d.connectTo(e,function(b){return b?void(a.alert.value={msg:b.message,level:"error"}):void c.path("/info")})},b.hostsOpts={colDef:[{name:"URL",field:"url"},{name:"last connected",field:"lastConnected",filter:{name:"date",options:"mediumDate"}},{name:"Created",field:"created",filter:{name:"date",options:"mediumDate"}},{name:"Actions",buttons:[{name:'<i class="glyphicon glyphicon-log-in"></i> Connect',"class":"btn btn-xs btn-primary",click:function(a){b.connect(a.url)}}],compile:!0}],globalFilter:!0}}]),angular.module("dockerUiApp").service("http",["$http",function(a){function b(a,b){return a.replace(/(\/:[^\/]+)/g,function(a,c){var d,e=c.substr(2);return b.hasOwnProperty(e)?(d=b[e],delete b[e],"/"+d):""})}function c(a,b){var c,d,e,f,g={},h=Object.getOwnPropertyNames(a),i=h.length;for(c=0;i>c;c+=1)d=h[c],e=a[d],f=e,"@"===e[0]?f=b[e.substr(1)]:"="===e[0]&&(e=d,f=b[e]),void 0!==f&&(g[d]=f);return g}function d(d){return function(e,f,h){function i(a){return function(){var b=[].slice.call(arguments);if(angular.isFunction(m)){if("error"===a)return void m.apply(null,b)}else{if("error"===a)return void h.apply(this,b);b.unshift(null)}h.apply(this,b)}}angular.isFunction(e)?(h=e,e=f={}):angular.isFunction(f)?(h=f,f=e):angular.isFunction(h)||(h=angular.noop),e=e||{};var j,k,l,m=e.hasOwnProperty("errorHandler")?e.errorHandler:g.errorHandler;return delete e.errorHandler,j=b(g.url()+d.url,e),e=c(angular.copy(d.params||{}),e),k={method:d.method||"GET",url:j,params:e},d.target&&"self"===d.target?void(location.href=k.url):(("POST"===d.method||"PUT"===d.method)&&(k.data=f),d.withCredentials&&(k.withCredentials=!0),d.responseType&&(k.responseType=d.responseType),d.timeout&&(k.timeout=d.timeout),d.headers&&(k.headers=d.headers),d.transformRequest&&(k.transformRequest=d.transformRequest),l=a(k),angular.isFunction(h)&&l.success(function(a,b){b=!b||b>400?"error":"success",a||"error"!==b||(a="Connection refused"),i(b)(a)}).error(i("error")),l)}}function e(a,b){b=b||{};var c;for(c in a)a.hasOwnProperty(c)&&(b[c]=d(a[c]));return b}function f(a,b,c,d){angular.extend(g,{url:a});var f,h,i,j=new FormData,k={path:b,files:{}};for(f=0;f<c.length;f+=1)h=c[f],k.files[h.name]=h.size;for(j.append("metadata",JSON.stringify(k)),f=0;f<c.length;f+=1)j.append("uploadInput",c[f]);i=e({uploadFile:{method:"POST",data:j,transformRequest:angular.identity,headers:{"Content-Type":void 0},params:{}}}),i.uploadFile({},j,d)}var g={url:"",errorHandler:null};return{createMethod:d,config:function(a){angular.extend(g,a)},createService:e,uploadFiles:f}}]),angular.module("dockerUiApp").service("Docker",["$rootScope","$q","$cookies","http","$http","urlParser","stream","Config","Dialogs",function(a,b,c,d,e,f,g,h,i){function j(){return this instanceof j?this.servers[h.host]?this.servers[h.host]:(this.servers[h.host]=this,this):new j}return j.prototype.servers={},j.prototype.client=function(){return this.servers[h.host]},d.config({url:function(){return h.host+"/:service/:p1/:p2"},errorHandler:function(b){a.alert=a.alert||{},a.alert.value={type:"error",msg:b}}}),d.createService({containers:{cache:!1,url:"/containers/json",params:{size:"=",all:"="}},inspect:{url:"/containers/:Id/json"},processList:{cache:!1,url:"/containers/:Id/top",params:{ps_args:"="}},create:{method:"POST",url:"/containers/create",params:{name:"="}},resize:{method:"POST",url:"/containers/:Id/resize",params:{w:"=",h:"="}},changes:{url:"/containers/:Id/changes"},start:{method:"POST",url:"/containers/:Id/start"},stop:{method:"POST",url:"/containers/:Id/stop"},restart:{method:"POST",url:"/containers/:Id/restart"},kill:{method:"POST",url:"/containers/:Id/kill"},destroyContainer:{method:"DELETE",url:"/containers/:Id"},commitContainer:{method:"POST",url:"/commit",params:{container:"=",repo:"=",tag:"=",m:"=",author:"=",run:"="}},"export":{target:"self",url:"/containers/:Id/export"},images:{cache:!1,url:"/images/json",params:{all:"="}},inspectImage:{url:"/images/:Id/json"},historyImage:{url:"/images/:Id/history"},tagImage:{method:"POST",url:"/images/:Id/tag",params:{repo:"=",force:0}},deleteImage:{method:"DELETE",url:"/images/:Id"},searchImage:{url:"/images/search",params:{term:"="}},uploadImage:{method:"POST",headers:{"X-Registry-Auth":"="},url:"/images/:Name/push",params:{tag:"="}},info:{url:"/info"},version:{url:"/version"},auth:{method:"POST",url:"/auth",error:!0},ping:{url:"/_ping"}},j.prototype),j.prototype.createContainer=function(a){return i.createContainer(a)},j.prototype.destroy=function(a){return i.destroy(a)},j.prototype.commit=function(a){return i.commit(a)},j.prototype.createImage=function(a,b){var c={url:h.host+"/images/create?"+(a.query||""),method:a.method||"POST",headers:{"X-Registry-Auth":"="},parseStream:!0,progressHandler:a.progressHandler},d=g.request(c);return d.then(b),d},j.prototype.pushImage=function(a,b){var c=this;i.pushImage(a.tags).then(function(d){var e=c.parseTag(d),f={url:h.host+"/images/"+e.nameWithRegistry+"/push?"+(a.query||""),method:a.method||"POST",headers:{"X-Registry-Auth":"="},body:JSON.stringify({tag:e.tag||"latest"}),parseStream:!0,progressHandler:a.progressHandler},i=g.request(f);i.then(b)})},j.prototype.events=function(a,b,c){var d={url:h.host+"/events?"+a||"since=1",method:"GET",parseStream:!0,progressHandler:b},e=g.request(d);return e.then(c),e},j.prototype.logs=function(a,b,c){var d,e,f=[];return["stderr","stdout","tail"].forEach(function(b){a[b]&&f.push(b+"="+a[b])}),f.push("timestamps=0&follow=1"),d={url:h.host+"/containers/"+a.ID+"/logs?"+f.join("&"),method:"GET",parseStream:!1,progressHandler:b},e=g.request(d),e.then(c),e},j.prototype.authenticate=function(a,b){var c=this;a?c.auth(a,function(){i.auth(a).then(b.bind(null,null),b)}):i.auth(a).then(b.bind(null,null),b)},j.prototype.getImageTags=function(a){return e.get("https://jsonp.nodejitsu.com/?url="+encodeURIComponent("https://index.docker.io/v1/repositories/"+a+"/tags"))},j.prototype.hosts=function(){var a={};try{a=JSON.parse(c.dockerHosts)}catch(b){}return a},j.prototype.connectTo=function(d,g){g=g||angular.noop;var i,j,k,l,m=this,n=b.defer(),o=f(d);return d=o.protocol+"//"+o.host,e.get(d+"/_ping",{timeout:3e3,cache:!1}).then(function(b){if(200!==b.status){var e=(b.statusText||'Failed to connect to host "'+d+'"')+(b.data?"\n"+b.data:"");return n.reject(new Error(e)),g(new Error(e))}a.dockerHost=h.host=c.dockerHost=d,k=m.hosts(),l=k[d],l?(delete k[d],l.lastConnected=(new Date).getTime(),k[d]=l):k[d]={created:(new Date).getTime(),lastConnected:(new Date).getTime()},i=Object.getOwnPropertyNames(k),j=i.length,Object.keys(k).splice(0,j-h.hostsHistoryLength).forEach(function(a){delete k[a]}),c.dockerHosts=JSON.stringify(k),n.resolve(k),g(null,k)}),n.promise},j.prototype.parseTag=function(a){var b=/^(?:([^/]+(?::\d+)?)\/)?((?:([^\/]+)\/)?([^:]+))(?::(.+))?$/.exec(a);return b?(!b[3]&&b[1]&&(b[3]=b[1],b[2]=b[1]+"/"+b[4],b[1]=void 0),{tag:b[5],name:b[4],repository:b[3]||"",fullname:b[2],registry:b[1],nameWithRegistry:(b[1]?b[1]+"/":"")+b[2]}):{}},new j}]),angular.module("dockerUiApp").value("Config",{host:"http://localhost:4243",hostsHistoryLength:10,features:{registryAuth:!0}}),angular.module("dockerUiApp").directive("ngAppendHtml",["$compile",function(a){return function(b,c,d){c.append(a(angular.element(b.$eval(d.ngAppendHtml)))(b))}}]),angular.module("dockerUiApp").directive("dcGrid",["$compile","$parse","$rootScope","$filter",function(a,b,c,d){return{templateUrl:"views/dc-grid.html",restrict:"E",replace:!0,scope:{options:"=",items:"="},link:function(e){function f(a){return a.length?(e.totalItems=a.length,e.sortBy&&angular.isDefined(e.sortOrder)&&(a=d("orderBy")(a,e.sortBy,e.sortOrder)),e.rows=a.slice((e.currentPage-1)*e.maxSize,e.currentPage*e.maxSize),void(h=!1)):void(e.rows=[])}e.currentPage=1,e.maxSize=e.options.maxSize||10,e.nested=!!e.options.nested,e.active=null,e.rows=[];var g=[],h=!1;e.$watchCollection("items",function(a){h=!0,e.currentPage=1,g=a||[],f(g)}),e.$watch("currentPage",function(){h||f(g)}),e.sortBy=e.options.sortBy,e.sortOrder=!!e.options.sortBy,e.sort=function(a){e.sortBy!==a?(e.sortBy=a,e.sortOrder=!0):e.sortOrder?e.sortOrder=!1:(e.sortOrder=null,e.sortBy=null),f(g)},e.sortUp=function(a){return e.sortBy===a&&e.sortOrder===!0},e.sortDown=function(a){return e.sortBy===a&&e.sortOrder===!1},e.options.globalFilter&&c.$watch("search.value",function(a){h||(g=d("filter")(e.items,a),f(g))}),e.rowClass=function(a){return e.options.rowClass?e.options.rowClass(a):""},e.get=function(c,f){var g=b(f.field),h=g(e,c),i=null;return c.$watch=function(a,b){b(a(c),null)},Array.isArray(f.buttons)?(i="",f.buttons.forEach(function(a,b){i+='<button class="btn '+a.class+'" data-ng-click="def.buttons['+b+'].click(row)">'+a.name+"</button>"}),i):("function"==typeof f.map?h=f.map(h,c):"string"==typeof f.map&&(i=angular.element("<div>"+f.map+"</div>"),h=a(i)(c).html()),f.filter&&(h="string"==typeof f.filter?d(f.filter)(h):d(f.filter.name)(h,f.filter.options)),f.link?(i=angular.element('<div><a href="#!'+f.link+'">'+h+"</a></div>"),i=a(i)(c).html()):i=h,void 0===i&&(i=""),"<span>"+i+"</span>")}}}}]),angular.module("dockerUiApp").controller("ContainerCtrl",["$scope","$routeSegment","$timeout","$location","urlParser","Config","Docker","Dialogs","terminal","container",function(a,b,c,d,e,f,g,h,i,j){function k(){b.chain.slice(-1)[0].reload()}function l(a){var b=a.window,c=a.document,d=c.documentElement,e=c.getElementsByTagName("body")[0],f=b.innerWidth||d.clientWidth||e.clientWidth,g=b.innerHeight||d.clientHeight||e.clientHeight;return{width:f,height:g}}function m(a,b,c){var d=a.window,e=a.document,f=e.documentElement,g=e.getElementsByTagName("body")[0];d.innerWidth=f.clientWidth=g.clientWidth=b,d.innerHeight=f.clientHeight=g.clientHeight=c}function n(){a.active=!1,a.activeTab={},a.Console.logs.connection&&a.Console.logs.connection.abort(),a.Console.logs.terminal&&(a.Console.logs.terminal.destroy(),a.Console.logs.terminal=!1),a.Console.terminal&&a.Console.terminal.destroy()}a.active=!0,a.container=j,a.containerId=j.Id.slice(0,12),a.changes=[],a.Console={logs:{terminal:null,connection:null}},a.changesOpts={colDef:[{name:"Filename",field:"Path"}],rowClass:function(a){return{warning:!!a.Kind}},maxSize:5},a.activeTab={},a.processList=function(b){a.containerId&&a.container.State.Running&&g.processList({Id:a.containerId,ps_args:"axwuu"},function(b){a.processes=b}),a.activeTab[b]&&a.active&&c(a.processList.bind(a,b),2e3)},a.logs=function(){var b=document.getElementById("logTerminal");if((b&&a.containerId||a.Console.logs.terminal)&&!a.Console.logs.terminal){var c=a.Console.logs.terminal=new Terminal({cols:0,rows:0,useStyle:!0,screenKeys:!0,cursorBlink:!1});c.open(b);var d=a.Console.logs.connection=g.logs({ID:a.containerId,stdout:1,stderr:1,tail:100},function(e){b?e.split("\n").forEach(function(a){c.write(a+"\r\n")}):(d.abort(),c.destroy(),a.Console.logs.terminal=!1)})}},a.start=function(){a.containerId&&g.start({Id:a.containerId},k)},a.stop=function(){a.containerId&&g.stop({Id:a.containerId},k)},a.restart=function(){a.containerId&&g.restart({Id:a.containerId},k)},a.kill=function(){a.containerId&&g.kill({Id:a.containerId},k)},a.destroy=function(){a.containerId&&g.destroy({Id:a.containerId}).then(function(a){a&&d.path("/containers")})},a.clone=function(){var b=angular.extend({},a.container.Config,{HostConfig:a.container.HostConfig});delete b.Id,-1===b.Image.indexOf(":")&&(b.Image+=":latest"),h.createContainer(b)},a.commit=function(){a.containerId&&g.commit(a.container).then(function(a){a&&d.path("/image/"+a.Id.slice(0,12))})},a.attachConsole=function(){if(!a.containerId||!a.Console.terminal){var b,c=e(f.host),d=document.getElementById("terminal");b=("https:"===c.protocol?"wss":"ws")+"://"+c.host+"/containers/"+a.containerId+"/attach/ws?logs=0&stream=1&stdout=1&stderr=1&stdin=1",d.innerHTML="",a.Console.terminal=i(d,b)}},a.openInNewWindow=function(){var b,c="Terminal: "+a.container.Name,d=window.open("about:blank",c,"width=540, height=322, location=no, menubar=no, resizable=no, scrollbars=no, status=no, titlebar=no, toolbar=no");if(d.document.body.style.margin=0,d.document.body.style.padding=0,d.document.head.innerHTML="<title>"+c+"</title>",a.Console.terminal){b=i(d.document.body,a.Console.terminal.address),d.onbeforeunload=function(){b.destroy()};var e=l(d);d.window.onresize=function(){var c=l(d),f=Math.floor(c.width/6.7),h=Math.floor(c.height/13.05);g.resize({Id:a.container.Id,h:h,w:f}).then(function(){e=c,b.tty.resize(f,h)},function(){m(d,e.width,e.height),console.log(arguments)})}}},a.getChanges=function(){g.changes({Id:a.containerId},function(b){a.changes=b})},a.createAs=function(){g.createContainer(a.container.Config).then(function(a){a&&d.path("/container/"+a.Id.slice(0,12))})},a.export=function(){g.export({Id:a.containerId})},a.$on("$destroy",n),a.$on("$routeChangeSuccess",function(){b.chain.slice(-1)[0].reload()})}]),angular.module("dockerUiApp").filter("calcMem",function(){return function(a,b){var c,d=parseInt(a,10)||0,e=["bytes","Mb","Gb","Tb","Pb"];for(b=b||"bytes",d||(d=0),b||(b="bytes"),c=e.indexOf(b),c=c>=0?c:0;c<e.length;c+=1)if(c){if(!(d>1024))break;d/=1024,b=e[c-1]}return d.toFixed(2)+(d?b:"")}}),angular.module("dockerUiApp").controller("ImageCtrl",["$scope","$routeSegment","$location","Docker","image",function(a,b,c,d,e){a.image=e,a.destroyImage=function(){d.deleteImage({Id:e.Id.slice(0,12)},function(){c.path("/images")})},a.imageHistoryOpts={colDef:[{name:"Id",field:"Id",filter:"shortTag",link:"/image/{{ Id | shortTag }}"},{name:"Created By",field:"CreatedBy",style:"max-width: 500px;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",map:function(){return"<span>{{ row.CreatedBy || '' }}</span>"}},{name:"Date",field:"Created",map:function(a){return new Date(1e3*a)},filter:"date"},{name:"Size",field:"Size",filter:"calcMem"}],maxSize:5},a.onTagAdded=function(b){if(!d.parseTag(b).name)return!1;var c=a.image.info.RepoTags;d.tagImage({Id:e.Id,repo:b.text}).then(function(){var a=c.indexOf(b);c.splice(a,1)})},a.onTagRemoved=function(a){return d.parseTag(a).name?void d.deleteImage({Id:a||e.Id},function(a){var b=a.slice(-1)[0]||{};b.Deleted===e.Id&&c.path("/images")}):!1},a.pushImage=function(){var a=(e.info.RepoTags||[]).map(function(a){return a.text||a});d.pushImage({tags:a,progressHandler:function(){console.log(arguments)}},function(){console.log("Image pushed",arguments)})},a.$on("$routeChangeSuccess",function(){b.chain.slice(-1)[0].reload()})}]),angular.module("dockerUiApp").controller("ImagesSearchCtrl",["$scope","$modal","Docker",function(a,b,c){function d(a,b,c){return'<i class="glyphicon glyphicon-star'+(a?"":"-empty")+'"'+(void 0!==c?' title="'+c+'"':"")+"></i>"}function e(b){var c=Math.round(a.maxRate?b/a.maxRate*5:0);return[1,2,3,4,5].map(function(a,e){return d(c&&c>=e,void 0,b)}).join("")}function f(a){var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}a.images=[],a.imageSearch="",a.maxRate=0,a.doSearch=function(){c.searchImage({term:a.imageSearch},function(b){b.forEach(function(b){a.maxRate=a.maxRate>=b.star_count?a.maxRate:b.star_count}),a.images=b})},a.selectImageTag=function(a,d){c.getImageTags(a.name).then(function(c){b.open({templateUrl:"views/image-version-choice.html",controller:["$scope","$modalInstance",function(b,e){b.image=a,b.tags=c.data,b.selected={tag:{name:"latest"}},b.ok=function(){e.close(),d(null,b.selected.tag)},b.cancel=function(){e.close(),d("canceled")}}]})})},a.downloadImage=function(d,e){e=e||"latest",a.progress={},b.open({templateUrl:"views/download-image.html",keyboard:!1,backdrop:"static",resolve:{image:function(){return d},progress:function(){return a.progress}},controller:["$scope","$modalInstance","image","progress",function(a,b,c,d){a.image=c,a.progress=d,a.tag=e,a.background=function(){b.close()}}]}),c.createImage({query:"fromImage="+d.name+"&tag="+e,progressHandler:function(b){Array.isArray(b)&&(b.forEach(function(b){if(!b.id)return void(d.statusMessage=b.status);var c=a.progress[b.id]||{active:!0,total:0,k:0};a.progress[b.id]=c,f(b.progressDetail)||(c.start=c.start||new Date(1e3*b.progressDetail.start),c.total=b.progressDetail.total,c.current=b.progressDetail.current,c.k=100*c.current/c.total),"Download complete"===b.status&&(c.k=100,c.current=c.total,c.active=!1),c.status=b.status}),a.$apply())}},function(){console.warn("Download complete?",arguments)})},a.download=function(b){b=b||{name:a.imageSearch},a.selectImageTag(b,function(c,d){c||a.downloadImage(b,d.name)})},a.imagesOpts={colDef:[{name:"Name",field:"name"},{name:"Trusted",field:"is_trusted",map:d},{name:"Official",field:"is_official",map:d},{name:"Rating",field:"star_count",map:e},{name:"Description",field:"description",style:"max-width: 500px;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",map:function(){return'<span data-popover="{{ row.description }}" data-popover-trigger="mouseenter">{{ row.description }}</span>'}},{name:"Actions",buttons:[{name:'<i class="glyphicon glyphicon-download"></i> Download',"class":"btn btn-xs btn-primary",click:a.download}],compile:!0}],globalFilter:!0}}]);var lowercase=function(a){return angular.isString(a)?a.toLowerCase():a},msie=int((/msie (\d+)/.exec(lowercase(navigator.userAgent))||[])[1]);isNaN(msie)&&(msie=int((/trident\/.*; rv:(\d+)/.exec(lowercase(navigator.userAgent))||[])[1]));var XHR=window.XMLHttpRequest||function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}throw new Error("This browser does not support XMLHttpRequest.")};angular.module("dockerUiApp").factory("stream",["$q","$timeout","$rootScope","Config",function(a,b,c,d){var e=-1;return{request:function(f){function g(){function a(a){try{return angular.fromJson(a)}catch(b){return void 0}}function b(a,b,c){var d=a.substring(c||0).search(b);return d>=0?d+(c||0):d}for(var c,d,e,f=[];-1!==(c=b(k.response,/}\s*\{/,n))&&(d=k.response.slice(n,c+1),e=a(d),void 0!==e);)f.push(e),n=c+1;return d=k.response.slice(n),e=a(d),void 0!==e&&(f.push(e),n=k.response.length),f}function h(){o.completed!==o.current&&(o.completed=o.current,k.response&&(f.parseStream?f.progressHandler(g()):(f.progressHandler(k.response.slice(n)),n=k.response.length)))}function i(){j=e,k&&k.abort()}var j,k=new XHR,l=f.headers||{},m=a.defer(),n=0,o={completed:0,current:0};return angular.isFunction(f.progressHandler)&&(k.onprogress=function(){o.current++,h()}),k.onreadystatechange=function(){j=k.status;var a=null,b=null;switch(k.readyState){case 1:case 2:case 3:angular.isFunction(f.progressHandler)&&o.completed===o.current&&(o.current++,h());break;case 4:j!==e&&(a=k.getAllResponseHeaders(),b=k.responseType?k.response:k.responseText),m.resolve(j||k.status,b,a)}},f.withCredentials&&(k.withCredentials=!0),f.responseType&&(k.responseType=f.responseType),f.timeout>0&&b(i,f.timeout),k.open(f.method,f.url,!0),l["X-Registry-Auth"]&&(c.auth&&d.features.registryAuth?l["X-Registry-Auth"]=c.auth.data:delete l["X-Registry-Auth"]),angular.forEach(l,function(a,b){angular.isDefined(a)&&k.setRequestHeader(b,a)}),k.send(f.body),m.promise.abort=function(){k&&k.abort()},m.promise.ended=function(){return 4===k.readyState},m.promise.write=function(a){k.status<4&&k.send(a)},m.promise}}}]),angular.module("dockerUiApp").controller("InfoCtrl",["$scope","Config","info",function(a,b,c){a.info=c,a.version=c.version,a.Config=b}]),angular.module("dockerUiApp").filter("shortTag",function(){return function(a){return a&&a.slice(0,12)}}),angular.module("dockerUiApp").service("terminal",function(){var a={};return function(b,c,d){function e(b){function d(a){e["on"+a.toLowerCase()]=function(){var b=this,c=arguments;angular.forEach(e.clients,function(d){angular.isFunction(d["on"+a])&&d["on"+a].apply(b,c)})}}var e=b.socket,f=e&&e.clients;e&&1===e.readyState||(e=b.socket=new WebSocket(c)),e.clients=f||[],-1===e.clients.indexOf(b)&&e.clients.push(b),a[c]=e,d("Open"),d("Message"),d("Close")}var f=a[c],g=angular.extend({socket:f,tty:new Terminal({cols:0,rows:0,useStyle:!0,screenKeys:!0}),onMessage:function(a){g.tty.write(a.data)},onClose:function(){e(g)},onData:function(a){1===g.socket.readyState&&g.socket.send(a)}},d);return e(g),g.tty.on("data",g.onData.bind(g.tty)),g.tty.open(b),{tty:g.tty,address:c,get socket(){return g.socket||{clients:[]}},set socket(a){return a},destroy:function(){g.tty.destroy();var a=this.socket.clients.indexOf(g);a>-1&&this.socket.clients.splice(a,1),this.socket.clients.length||this.socket.close()}}}}),angular.module("dockerUiApp").controller("CreateContainerCtrl",["$scope","Docker","$filter","$q","$location","$modalInstance","input",function(a,b,c,d,e,f,g){function h(a,b){b=Array.isArray(b)?b[0]:b;var c=[];return b&&(b.HostIp&&c.push(b.HostIp),b.HostPort&&c.push(b.HostPort)),c.push(a.split("/")[0]),c.join(":")}function i(a){var b=a.split(":"),c={},d=b.pop(),e={HostPort:b.pop()},f=d.split("/")[1];return c[d+"/"+(f||"tcp")]=[e],b.length&&(e.HostIp=b.pop()),c}function j(a){return angular.isArray(a)?a:a?a.match(/(?:[^\s"']+|"([^"]*)"|'([^']*)')+/g).map(function(a){var b=a.substr(0,1),c=a.substr(-1);return('"'===b&&'"'===c||"'"===b&&"'"===c)&&(a=a.slice(1,-1)),a}):[]}a.input=g,a.tmp={ExposedPorts:Object.keys(g.HostConfig.PortBindings).map(function(a){return h(a,g.HostConfig.PortBindings[a])}),Volumes:[],Devices:[],LxcConf:[]},a.images=[],a.containers=[],a.containerNames=[],b.images(function(b){a.images=b}),b.containers({all:!0},function(b){a.containers=b,a.containerNames=b.map(function(a){var b=a.Names[0];return b&&b.substr(1)||a.Id.substr(0,12)})}),a.networkTypes=["none","bridge","host","container"],a.restartPolicies=["none","always","on-failure"],a.loadConfig=function(){b.inspectImage({Id:a.input.Image[0]},function(b){a.input=angular.extend({},b.Config,a.input)})},a.addExposedPort=function(b){var c=i(b);angular.extend(a.input.ExposedPorts,c),angular.extend(a.input.HostConfig.PortBindings,c)},a.removeExposedPort=function(b){var c=Object.keys(i(b))[0];delete a.input.ExposedPorts[c],delete a.input.HostConfig.PortBindings[c]},a.addDevice=function(b){var c=b.split(":");a.input.HostConfig.Devices.push({PathOnHost:c.shift(),PathInContainer:c.shift(),CgroupPermissions:c.shift()})},a.removeDevice=function(b){var c=b.split(":"),d=-1;a.input.HostConfig.Devices.some(function(a,b){return a.PathOnHost===c[0]&&a.PathInContainer===c[1]&&a.CgroupPermissions===c[2]?(d=b,!0):void 0}),-1!==d&&a.input.HostConfig.Devices.splice(d,1)},a.addVolume=function(b){var c=b.split(":");a.input.Volumes[c[1]||c[0]]={}},a.removeVolume=function(b){var c=b.split(":");delete a.input.Volumes[c[1]||c[0]]},a.addLxcConf=function(b){var c=b.split(":");a.input.HostConfig.LxcConf[c[0]]=c[1]},a.removeLxcConf=function(b){var c=b.split(":");delete a.input.HostConfig.LxcConf[c[0]]},a.prev=function(){angular.element(document.getElementsByClassName("carousel-indicators")[0]).scope().prev()},a.next=function(){angular.element(document.getElementsByClassName("carousel-indicators")[0]).scope().next()},a.ok=function(){var c={},d=angular.extend({},a.input);d.Cmd=j(d.Cmd),d.Volumes&&d.Volumes.length&&(d.Volumes.forEach(function(a){var b=a.split(":");
c[b[1]]={},d.HostConfig.Binds.push(a)}),d.Volumes=c),d.Image=Array.isArray(d.Image)?d.Image[0]:d.Image,"container"===d.HostConfig.NetworkMode&&(a.input.NetContainer?d.HostConfig.NetworkMode="container:"+a.input.NetContainer.substr(1):delete d.HostConfig.NetworkMode),angular.extend(d,d.HostConfig),console.log(d),b.create(d,function(a){b.start(angular.extend({Id:a.Id},d.HostConfig),function(){e.path("/container/"+a.Id.substr(0,12)),f.close(a)})})},a.cancel=function(){f.close()}}]),angular.module("dockerUiApp").controller("DestroyCtrl",["$scope","Docker","$modalInstance","instance",function(a,b,c,d){a.ok=function(){b.destroyContainer({Id:d.Id.slice(0,12),v:a.removeAll},function(){c.close(!0)})},a.close=function(){c.dismiss()}}]),angular.module("dockerUiApp").controller("CommitCtrl",["$scope","Docker","$modalInstance","instance",function(a,b,c,d){a.input={repo:d.Name.substr(1),container:d.Id.slice(0,12)},a.ok=function(){b.commitContainer(a.input,function(a){c.close(a)})},a.close=function(){c.dismiss()}}]),angular.module("dockerUiApp").controller("AuthCtrl",["$scope","Docker","$modalInstance","auth",function(a,b,c,d){a.auth=d,a.login=function(){b.auth(a.auth,function(b){"Login Succeeded"===b.Status?c.close(a.auth):c.dismiss(new Error(b))})},a.close=function(){c.dismiss()}}]),angular.module("dockerUiApp").service("Dialogs",["$modal",function(a){return{auth:function(b){return a.open({templateUrl:"views/auth.html",resolve:{auth:function(){return b||{}}},controller:"AuthCtrl"}).result},commit:function(b){return a.open({templateUrl:"views/commit-container.html",resolve:{instance:function(){return b}},controller:"CommitCtrl"}).result},createContainer:function(b){var c={Hostname:"",Domainname:"",User:"",Memory:0,MemorySwap:0,CpuShares:null,Cpuset:null,AttachStdin:!1,AttachStdout:!1,AttachStderr:!1,Tty:!0,OpenStdin:!0,StdinOnce:!1,Env:[],Cmd:[],Entrypoint:[],Image:"",Volumes:{},WorkingDir:"",NetworkDisabled:!1,MacAddress:null,ExposedPorts:{},SecurityOpts:[],HostConfig:{Binds:[],Links:[],LxcConf:{},PortBindings:{},PublishAllPorts:!1,Privileged:!1,Dns:["8.8.8.8","8.8.4.4"],DnsSearch:[],ExtraHosts:[],VolumesFrom:[],CapAdd:[],CapDrop:[],RestartPolicy:{Name:"",MaximumRetryCount:0},NetworkMode:"bridge",Devices:[]}};return a.open({templateUrl:"views/create-container.html",resolve:{input:function(){return angular.extend({},c,b)}},controller:"CreateContainerCtrl",controllerAs:"CC"}).result},destroy:function(b){return a.open({templateUrl:"views/destroy-container.html",resolve:{instance:function(){return b}},controller:"DestroyCtrl"}).result},pushImage:function(b){return a.open({templateUrl:"views/push-image.html",resolve:{tags:function(){return b}},controller:"PushImageCtrl"}).result}}}]),angular.module("dockerUiApp").controller("PushImageCtrl",["$scope","$modalInstance","tags","$filter",function(a,b,c,d){console.info("Tags:",c),a.input={tag:""},a.tags=c,a.getTags=function(a){return d("filter")(c,a)},a.ok=function(){b.close(a.input.tag)},a.close=b.dismiss.bind(b)}]),angular.module("dockerUiApp").service("urlParser",function(){return function(a){var b=document.createElement("a");return b.href=a,b}});